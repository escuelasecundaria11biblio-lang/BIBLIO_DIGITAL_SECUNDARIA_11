<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Biblioteca Digital - Retiros</title>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyB-xkjdruerF7AOthyu45T_bETa97x6_pg",
        authDomain: "farmacia-web-d0d71.firebaseapp.com",
        projectId: "farmacia-web-d0d71",
        storageBucket: "farmacia-web-d0d71.firebasestorage.app",
        messagingSenderId: "580153875699",
        appId: "1:580153875699:web:aa53b21ba70a5bc7396b86"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            width: 100%;
            background-color: #0e0955;
            color: white;
            padding: 15px 0;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            height: 7%;
            z-index: 1000;
        }

        .navbar img {
            height: 98px;
            width: 63px;
            margin-top: -22px;
            margin-right: 90%;
        }

        .container {
            margin-top: 12%;
            margin-left: 26%;
        }

        #barraInput_libro, #barraInput_alumno {
            border-radius: 30px;
            border: 1px solid #707070;
            height: 50px;
            padding-left: 15px;
            font-size: 16px;
        }

        #barraInput_libro {
            width: 38%;
            margin-left: 3%;
            margin-top: -150px;
        }

        #barraInput_alumno {
            width: 45%;
            margin-left: 48%;
            margin-top: -422px;
            position: relative; /* âœ… agregado */
            z-index: 10; /* âœ… opcional, o podÃ©s no ponerlo */
        }


        .ficha_libro {
            width: 40%;
            margin-left: 3%;
            margin-top: 30px;
            height: 330px;
            border: 3px solid #000000;
            background-color: #ffffff;
        }

        .ficha_alumno {
            width: 48%;
            margin-left: 48%;
            height: 330px;
            border: 3px solid #000000;
            background-color: #ffffff;
            margin-top: 30px;
            z-index: 1;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px 20px;
            padding: 20px;
            margin-top: 18px;
            box-sizing: border-box;
        }

        .form-grid.libro {
            grid-template-columns: 1fr;
            margin-top: -5px;
        }

        .campo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .campo span {
            width: 100px;
            font-weight: bold;
        }

        .campo input,
        .campo select {
            width: 65%;
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #guardarFichaBtn {
            background-color: #4CAF50;
            color: white;
            padding: 15px 32px;
            margin-left: 40%;
            margin-top: 30px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        #guardarFichaBtn:hover {
            background-color: #45a049;
        }

        /* ðŸ”¹ MODO RESPONSIVE para Android */
        @media (max-width: 768px) {
            body {
                padding-top: -120px; /* baja todo un poco mÃ¡s debajo de la navbar */
            }

            .navbar {
                height: 35px;
                padding: 10px 0;
            }
            .container {
                margin-left: 290px;
                text-align: center;
                margin-top: 70px; /* baja el tÃ­tulo */
            }

            h1 {
                font-size: 24px;
                margin: 30px 0;
            }

            #barraInput_libro {
                width: 80%;
                margin: 25px auto;
                display: block;
                margin-left: 18px;
                margin-top: -180px;
            }

            .ficha_libro {
                width: 82%;
                margin: 25px auto;
                margin-left: 20px;
                height: 280px;
                margin-top: -5px;
                padding-top: 10px;
            }

            #barraInput_alumno {
                width: 80%;
                margin: 25px auto;
                display: block;
                margin-left: 18px;
                position: relative;
                top: 0;
            }

            .ficha_alumno {
                width: 82%;
                margin: 25px auto 50px auto;
                position: relative;
                margin-left: 20px;
                height: 360px;
                top: -30px;
            }

            #guardarFichaBtn {
                margin-left: 0;
                width: 85%;
                display: block;
                margin: 30px auto;
            }


            .form-grid {
                grid-template-columns: 1fr !important; /* fuerza una sola columna */
                gap: 15px; /* separa los campos verticalmente */
            }


        }

        .navbar-text {
            display: none; /* por defecto no se ve en escritorio */
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        /* Media query para pantallas mÃ³viles */
        @media (max-width: 768px) {
        .navbar img {
            display: none; /* oculta la imagen */
        }

        .container{
            margin-top: 220px;
            margin-right: 110px;
        }


       
        .navbar-text {
            display: inline; /* muestra el texto en lugar de la imagen */
        }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <span class="navbar-text">E.E.S NÂ°11</span>
    </div>

    <img src="imagenes/escudo_11.png" alt="escudo_11" id="escudo_11" style="width: 12%; height: 20%; margin-left: 80%; margin-top: 60px;" />

    <div class="container">
        <h1 style="font-size: 30px; color: #000;  margin-top: -270px; margin-left: -310px;">Prestar material</h1>
    </div>

    <input type="text" id="barraInput_libro" placeholder="Buscar libro...">

    <div class="ficha_libro">
        <div class="form-grid libro">
            <div class="campo"><span>TÃ­tulo:</span><input type="text" id="libroTitulo" /></div>
            <div class="campo"><span>Autor:</span><input type="text" id="libroAutor" /></div>
            <div class="campo"><span>Editorial:</span><input type="text" id="libroEditorial" /></div>
            <div class="campo"><span>NÂ° Inv:</span><input type="text" id="libroInventario" /></div>
            <div class="campo"><span>Cantidad:</span><input type="text" id="libroCantidad" /></div>
        </div>
    </div>

    
    <input type="text" id="barraInput_alumno" placeholder="Buscar alumno por DNI...">

    <div class="ficha_alumno">
        <div class="form-grid">
            <div class="campo"><span>Apellido:</span><input type="text" id="alumnoApellido" /></div>
            <div class="campo"><span>Nombre:</span><input type="text" id="alumnoNombre" /></div>

            <div class="campo">
                <span>Curso:</span>
                <select id="alumnoCurso">
                    <option value="">Seleccionar curso</option>
                    <option>1Â° 1Â°</option>
                    <option>1Â° 2Â°</option>
                    <option>1Â° 3Â°</option>
                    <option>1Â° 5Â°</option>
                    <option>1Â° 6Â°</option>
                    <option>1Â° 7Â°</option>
                    <option>2Â° 1Â°</option>
                    <option>2Â° 2Â°</option>
                    <option>2Â° 3Â°</option>
                    <option>2Â° 4Â°</option>
                    <option>2Â° 5Â°</option>
                    <option>3Â° 1Â°</option>
                    <option>3Â° 2Â°</option>
                    <option>3Â° 3Â°</option>
                    <option>3Â° 4Â°</option>
                    <option>4Â° 1Â°</option>
                    <option>4Â° 2Â°</option>
                    <option>4Â° 3Â°</option>
                    <option>5Â° 1Â°</option>
                    <option>5Â° 2Â°</option>
                    <option>5Â° 3Â°</option>
                    <option>6Â° 1Â°</option>
                    <option>6Â° 2Â°</option>
                    <option>6Â° 3Â°</option>
                    <option>AFTE</option>
                </select>
            </div>

            <div class="campo">
                <span>Turno:</span>
                <select id="alumnoTurno">
                    <option value="">Seleccionar turno</option>
                    <option>MaÃ±ana</option>
                    <option>Tarde</option>
                    <option>Vespertino</option>
                </select>
            </div>

            <div class="campo"><span>DNI:</span><input type="text" id="alumnoDNI" /></div>
            <div class="campo"><span>Domicilio:</span><input type="text" id="alumnoDomicilio" /></div>
        </div>

        <button id="guardarFichaBtn">Guardar ficha</button>
    </div>

</body>
</html>


<script>
    // --- FUNCIONES para alumnos almacenados localmente ---
    function obtenerAlumnos() {
        const data = localStorage.getItem('alumnosRegistrados');
        return data ? JSON.parse(data) : [];
    }

    function guardarAlumnos(alumnos) {
        localStorage.setItem('alumnosRegistrados', JSON.stringify(alumnos));
    }

    // Autocompletar alumno por DNI buscando en localStorage
    const barraInputAlumno = document.getElementById('barraInput_alumno');
    const camposAlumno = document.querySelectorAll('.ficha_alumno input');

    barraInputAlumno.addEventListener('input', () => {
        const dni = barraInputAlumno.value.trim();
        if (!dni) {
            camposAlumno.forEach(input => input.value = "");
            return;
        }

        const alumnos = obtenerAlumnos();
        const alumno = alumnos.find(a => a["NÂ° DE DNI"] === dni);

        if (alumno) {
            // Si el nombre viene como "Apellido, Nombre" lo separamos
            let apellido = "";
            let nombre = "";
            if(alumno["APELLIDO Y NOMBRES"]) {
                const partes = alumno["APELLIDO Y NOMBRES"].split(",");
                apellido = partes[0].trim();
                nombre = partes[1] ? partes[1].trim() : "";
            }
            camposAlumno[0].value = apellido;
            camposAlumno[1].value = nombre;
            camposAlumno[2].value = alumno["LEGAJO"] || "";
            camposAlumno[3].value = alumno["CURSO"] || "";
            camposAlumno[4].value = alumno["TURNO"] || "";
            camposAlumno[5].value = alumno["NÂ° DE DNI"] || "";
            camposAlumno[6].value = alumno["DOMICILIO"] || "";
            camposAlumno[7].value = ""; // Cantidad queda libre
        } else {
            camposAlumno.forEach(input => input.value = "");
            camposAlumno[5].value = dni; // mantenemos el dni ingresado para que no se borre
        }
    });

    let libros = [];

    db.collection("libros").get().then(snapshot => {
    snapshot.forEach(doc => {
        libros.push(doc.data());
    });
    });


    const barraLibro = document.getElementById('barraInput_libro');
    const camposLibro = document.querySelectorAll('.ficha_libro input');

    barraLibro.addEventListener('input', () => {
        const valor = barraLibro.value.trim();

        const libro = libros.find(l => String(l.inventarioUnico) === valor);

        if (libro) {
            camposLibro[0].value = libro.titulo || "";
            camposLibro[1].value = libro.autor || "";
            camposLibro[2].value = libro.editorial || "";
            camposLibro[3].value = libro.materia || "";
            camposLibro[4].value = libro.inventarioUnico || "";
        } else {
            camposLibro.forEach(input => input.value = "");
        }
    });

    // --- Guardar ficha de prÃ©stamo y actualizar alumno localStorage ---
    document.getElementById("guardarFichaBtn").addEventListener("click", () => {
        // Datos libro
        const datosLibro = {
            titulo: document.getElementById('libroTitulo').value.trim(),
            autor: document.getElementById('libroAutor').value.trim(),
            editorial: document.getElementById('libroEditorial').value.trim(),
         
            inventario: document.getElementById('libroInventario').value.trim()
        };

        // Datos alumno
        const apellido = document.getElementById('alumnoApellido').value.trim();
        const nombre = document.getElementById('alumnoNombre').value.trim();
        const curso = document.getElementById('alumnoCurso').value.trim();
        const turno = document.getElementById('alumnoTurno').value.trim();
        const dni = document.getElementById('alumnoDNI').value.trim();
        const domicilio = document.getElementById('alumnoDomicilio').value.trim();

        const apellidosNombres = apellido && nombre ? `${apellido}, ${nombre}` : (apellido || nombre);

        const datosAlumno = {
            "APELLIDO Y NOMBRES": apellidosNombres,
            "CURSO": curso,
            "TURNO": turno,
            "NÂ° DE DNI": dni,
            "DOMICILIO": domicilio
        };

        if (!dni) {
            alert("Debe ingresar DNI del alumno.");
            return;
        }
        if (!datosLibro.titulo) {
            alert("Debe ingresar el tÃ­tulo del libro.");
            return;
        }

        // Actualizar o agregar alumno
        let alumnos = obtenerAlumnos();
        const index = alumnos.findIndex(a => a["NÂ° DE DNI"] === dni);

        if (index >= 0) {
            alumnos[index] = datosAlumno;
        } else {
            alumnos.push(datosAlumno);
        }
        guardarAlumnos(alumnos);

        // Guardar ficha
        const ficha = {
            alumno: datosAlumno,
            libro: datosLibro,
            fecha: new Date().toLocaleString()
        };

        let fichas = JSON.parse(localStorage.getItem("fichas_retiro")) || [];
        fichas.push(ficha);
        localStorage.setItem("fichas_retiro", JSON.stringify(fichas));

        alert("Ficha guardada correctamente.");

        // Limpiar campos
        document.querySelectorAll('.ficha_libro input').forEach(input => input.value = "");
        document.querySelectorAll('.ficha_alumno input').forEach(input => input.value = "");
        document.getElementById('barraInput_libro').value = "";
        document.getElementById('barraInput_alumno').value = "";

        window.location.href = "fichas_retiro.html";

    });

</script>





<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biblioteca Digital - Retiros</title>
<style>
  /* Modal bÃ¡sico */
  #authModal {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    z-index: 9999;
  }

  #authModalContent {
    background: #fff;
    padding: 25px 20px;
    border-radius: 10px;
    text-align: center;
    max-width: 400px;
    width: 90%;
  }

  #authModalContent input {
    width: 96%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
  }

  #authModalContent button {
    margin-top: 12px;
    padding: 8px 16px;
    border: none;
    background-color: #0e0955;
    color: white;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
  }

  #authMsg {
    margin-top: 8px;
    color: #b02a37;
    min-height: 18px;
  }
</style>
</head>
<body>

<script>
(function(){
  const PASSWORD = "ROBLIGADO25";

  // Crear modal
  const modal = document.createElement("div");
  modal.id = "authModal";
  modal.innerHTML = `
    <div id="authModalContent">
      <h3>Acceso restringido</h3>
      <p>Introduce la contraseÃ±a:</p>
      <input type="password" id="authInput" />
      <div>
        <button id="authBtn">Ingresar</button>
      </div>
      <div id="authMsg"></div>
    </div>
  `;
  document.body.appendChild(modal);

  const input = modal.querySelector("#authInput");
  const btn = modal.querySelector("#authBtn");
  const msg = modal.querySelector("#authMsg");

  function tryLogin() {
    if(input.value.trim() === PASSWORD){
      modal.style.display = "none";
    } else {
      msg.textContent = "ContraseÃ±a incorrecta";
      input.value = "";
      input.focus();
    }
  }

  btn.addEventListener("click", tryLogin);
  input.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") tryLogin();
  });

})();
</script>

</body>
</html>

</body>
</html>
