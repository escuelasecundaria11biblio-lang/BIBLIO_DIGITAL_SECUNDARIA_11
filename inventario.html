<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biblioteca Digital - Inventario</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    .navbar {
      width: 100%;
      background-color: #0e0955;
      color: white;
      padding: 15px 0;
      text-align: center;
      position: fixed;
      top: 0;
      left: 0;
      height: 7%;
      z-index: 1000;
    }

    .contenedor-cuadros {
      margin-top: 65px;
      margin-left: 2%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      align-items: stretch;
      gap: 40px 5px;
    }

    #btn-a침adir {
      background-color: #9fbaf5;
      width: 10%;
      border: 2px solid #000000;
      height: 68px;
      margin-left: 74%;
      font-size: 17px;
      margin-top: -68px;
    }

    .cuadro {
      width: 82%;
      height: 420px;
      background-color: #dddddd;
      margin-left: 10px;
      text-align: left;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .barra-busqueda {
      display: flex;
      padding-top: 40px;
      margin-left: -322px;
      justify-content: center;
    }

    #barraInput {
      width: 50%;
      padding: 12px 20px;
      border: 2px solid #000000;
      font-size: 16px;
      outline: none;
      height: 40px;
      margin-right: 80px;
      margin-top: 80px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      height: 80%;
      width: 80%;
      margin-top: 80px;
      text-align: center;
      border: 10px solid #0e0955; /* 游댳 borde azul marino */
      position: relative;
    }

    .modal input {
      width: 35%;
      padding: 10px;
      margin: 10px 0;
    }

    .modal button {
      padding: 10px;
      width: 170px;
      font-size: 16px;
      cursor: pointer;
      border: 2px solid #000;
      border-radius: 5px;
    }

    #btnEliminar {
      background-color: crimson;
      color: white;
      display: none;
    }

    .eliminar-btn {
      background-color: crimson;
      color: white;
      border: none;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      justify-items: center;
    }

    /* Contenedor para los botones debajo del campo inventario */
    .botones-accion {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 10px;
    }

    .ejemplares {
      width: 45%;
      height: 78%;
      margin-top: -355px;
      background-color: #c00f0f;
      margin-left: 54%;
    }

    #listaEjemplares {
      margin-top: -390px;
      width: 44%;
      height: 360px;
      margin-left: 588px;
      overflow-y: auto;
      background-color: #fff;
      border: 3px solid #000000;
      padding: 10px;
      box-sizing: border-box;
    }

    .editar-btn{
      background-color: #c00f0f;
      width: 70px;
      color: #fff;
      height: 35px;
      border: 2px solid #000000;
      

    }



    /* 游댳 Responsive mejorado para celulares */
    @media (max-width: 768px) {
      body {
        padding-top: 80px;
      }

      .navbar {
        height: 35px;
        padding: 10px 0;
      }

   

      /* 游댳 Barra de b칰squeda bien separada y centrada */
      #barraInput {
        width: 270px;
        margin: 5px auto 80px auto; /* Aument칠 margen inferior */
        font-size: 16px;
        position: relative;
        z-index: 2;
        
        transform: translateX(120px); /* mueve 20px a la izquierda */
        display: block;
      }

      /* 游댳 Contenedor de botones */
      div[style*="display: flex; justify-content: flex-start;"] {
        display: flex !important;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin: 30px auto 25px auto; /* Aument칠 margen superior */
        width: 95%;
        position: relative;
        z-index: 1;
      }

      div[style*="display: flex; justify-content: flex-start;"] button {
        flex: 1 1 45%;
        max-width: 48%;
        min-width: 140px;
        height: 55px;
        font-size: 15px;
      }

      /* 游댳 Cuadros de libros */
      .contenedor-cuadros {
        grid-template-columns: 1fr;
        margin-left: 0;
        gap: 20px;
        margin-top: 30px;
      }

      .cuadro {
        width: 90%;
        margin: 0 auto;
        height: auto;
        min-height: 250px;
      }

      /* 游댳 Modal responsive (para editar libro) */
      .modal-content {
        width: 90%;
        height: auto;
        margin: 25% auto;
        padding: 20px 15px;
        border: 4px solid #0e0955;
        border-radius: 15px;
        background: #fff;
        overflow-y: auto;
      }

      .modal-content h3 {
        font-size: 22px;
        margin-bottom: 20px;
        text-align: center;
      }

      /* 游댳 Campos dentro del modal */
      .form-grid {
        grid-template-columns: 1fr !important;
        gap: 15px;
        justify-items: center;
        
      }

      .form-grid label {
        font-size: 15px;
      }

      .form-grid input {
        width: 90% !important;
        margin: 0 auto !important;
        font-size: 15px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
      }

      #listaEjemplares{
        display: none;
      }

      /* 游댳 Mover el bot칩n Guardar debajo del t칤tulo "Nuevo libro" */
    @media (max-width: 768px) {
        #btn-guardar {
          order: -1; /* lo sube al principio del contenedor */
          margin: 15px auto 10px auto !important;
          display: block;
          width: 70%;
          font-size: 16px;
        }

        .botones-accion {
          flex-direction: column;
          align-items: center;
          gap: 10px;
        }
      }


      .botones-accion button {
        width: 45%;
        min-width: 130px;
        height: 45px;
        font-size: 15px;
        border-radius: 10px;
      }

      /* 游댳 Lista de ejemplares dentro del modal */
      #listaEjemplares {
        width: 90%;
        max-height: 250px;
        overflow-y: auto;
        margin: 20px auto;
        font-size: 14px;
      }
      
      #modal{
        width: 100%;
      }

      /* 游댳 Ajuste del bot칩n de a침adir */
      #btn-a침adir {
        margin-top: 0;
        margin-left: 0;
      }
    }

    .navbar-text {
      display: none; /* por defecto no se ve en escritorio */
      font-size: 20px;
      font-weight: bold;
      color: white;
    }

    /* Media query para pantallas m칩viles */
    @media (max-width: 768px) {
     
      .navbar-text {
        display: inline; /* muestra el texto en lugar de la imagen */
      }
    }
    


</style>
</head>
<body>
  <div class="navbar">
    <span class="navbar-text">E.E.S N춿11</span>
  </div>

  <div class="barra-busqueda">
    <input type="text" id="barraInput" placeholder="Buscar..." />
  </div>

  <img src="imagenes/escudo_11.png" alt="escudo_11" style="width: 12%; height: 20%; margin-left: 80%; margin-top: -9%;" />

  <div style="display: flex; justify-content: flex-start; gap: 20px; margin: 20px 2% 0 2%; margin-right: 97%; margin-top: -70px;">
    <button id="btn-a침adir" style="background-color:#9fbaf5; width: 180px; border: 2px solid #000000; height: 68px; font-size: 17px; margin-top: 0px;">
      A침adir libro
    </button>
    <button id="btn-backup" style="background-color: #e5c94a; width: 180px; border: 2px solid #000000; height: 68px; font-size: 17px;">
      Realizar Backup
    </button>
    <button id="btn-importar" style="background-color: #94e18c; width: 180px; border: 2px solid #000000; height: 68px; font-size: 17px;">
      Importar Backup
    </button>
    <input type="file" id="input-importar" accept=".json" style="display: none;" />
    <button id="btn-borrar-todo" style="background-color: #df0404; width: 180px; border: 2px solid #000000; height: 68px; font-size: 17px;">
      Eliminar inventario
    </button>
  </div>

  <div class="contenedor-cuadros"></div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitulo">Nuevo Libro</h3>

      <div class="form-grid">
        <input type="text" id="titulo" placeholder="T칤tulo del libro" style="margin-right: 190px;width: 180px;" />
        <input  type="date" id="fechaIngreso" placeholder="Fecha de ingreso" style="margin-left: -850px; width: 170px;" />
        <input type="text" id="autor" placeholder="Autor" style="margin-right: 190px;" />
        <input  type="text" id="editorial" placeholder="Editorial" style="margin-left: -850px; width: 170px;" />
        <input type="text" id="lugar" placeholder="Lugar de publicaci칩n" style="margin-right: 190px;" />
        <input  type="number" id="paginas" placeholder="Cantidad de p치ginas" style="margin-left: -850px; width: 170px;" />
        <input type="number" id="anio" placeholder="A침o de publicaci칩n" style="margin-right: 190px;"/>
        <input type="text" id="inventarioBase" placeholder="N칰mero de inventario inicial" style="margin-left: -850px; width: 170px;"  />
        <input type="number" id="cantidadEjemplares" placeholder="Cantidad de ejemplares" style="margin-right: 190px;" />
      </div>

      <!-- Botones alineados debajo del campo de inventario -->
      <div class="botones-accion">
        <button onclick="guardarLibro()" style="margin-left: -580px;" id="btn-guardar">Guardar cambios</button>
        <button id="btnEliminar" class="eliminar-btn" style="display:none;">Eliminar libro</button>
      </div>

      <input type="file" id="imagenInput" accept="image/*" style="display: none;" />
      <img id="imagenPreview" style="max-width: 100px; margin-top: 10px;" />

      <div id="listaEjemplares" style="padding: 5px; text-align: left;"></div>
    </div>
  </div>
</body>
</html>


  
  <script>
    const modal = document.getElementById('modal');
    const btnA침adir = document.getElementById('btn-a침adir');
    const imagenInput = document.getElementById('imagenInput');
    const imagenPreview = document.getElementById('imagenPreview');
    const modalTitulo = document.getElementById('modalTitulo');
    const listaEjemplares = document.getElementById('listaEjemplares');

    let imagenData = '';
    let modoEdicion = false;
    let docsEjemplaresActuales = [];
    let tituloOriginal = '';

    btnA침adir.addEventListener('click', () => {
      limpiarModal();
      modoEdicion = false;
      modalTitulo.textContent = 'Nuevo libro';
      modal.style.display = 'block';
    });

    imagenInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imagenData = e.target.result;
          imagenPreview.src = imagenData;
          imagenPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    function generarRectangulosEjemplares() {
      const inventarioBase = parseInt(document.getElementById('inventarioBase').value);
      const cantidad = parseInt(document.getElementById('cantidadEjemplares').value);
      listaEjemplares.innerHTML = ''; // limpiar antes de generar

      if (isNaN(inventarioBase) || isNaN(cantidad)) return;

      for (let i = 0; i < cantidad; i++) {
        const ejemplar = document.createElement('div');
        ejemplar.className = 'ejemplar';
        ejemplar.style.border = '1px solid #555';
        ejemplar.style.margin = '5px 0';
        ejemplar.style.padding = '5px';

        const inventario = inventarioBase + i;
        ejemplar.textContent = `Ejemplar ${i + 1}: ${inventario}`;
        listaEjemplares.appendChild(ejemplar);
      }
    }

    // Inicializar Firebase (con tu config)
    const firebaseConfig = {
      apiKey: "AIzaSyB-xkjdruerF7AOthyu45T_bETa97x6_pg",
      authDomain: "farmacia-web-d0d71.firebaseapp.com",
      projectId: "farmacia-web-d0d71",
      storageBucket: "farmacia-web-d0d71.firebasestorage.app",
      messagingSenderId: "580153875699",
      appId: "1:580153875699:web:aa53b21ba70a5bc7396b86",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function guardarLibro() {
      const titulo = document.getElementById('titulo').value.trim();
      const autor = document.getElementById('autor').value.trim();
      const editorial = document.getElementById('editorial').value.trim();
      const lugar = document.getElementById('lugar').value.trim();
      const paginas = parseInt(document.getElementById('paginas').value);
      const anio = parseInt(document.getElementById('anio').value);
      const inventarioBase = parseInt(document.getElementById('inventarioBase').value);
      const cantidadEjemplares = parseInt(document.getElementById('cantidadEjemplares').value);
      const fechaIngreso = document.getElementById('fechaIngreso').value;


      if (
        !titulo || !autor || !editorial || !lugar ||
        isNaN(paginas) || isNaN(anio) || isNaN(inventarioBase) || isNaN(cantidadEjemplares)
      ) {
        alert('Por favor complet치 todos los campos correctamente.');
        return;
      }

      try {
        if (!modoEdicion) {
          // A침adir nuevos ejemplares con ID personalizado
          const promesas = [];
          for (let i = 0; i < cantidadEjemplares; i++) {
            const inventario = inventarioBase + i;
            const idPersonalizado = `${titulo.replace(/\s+/g, '_')}-${inventario}`;

            const ejemplar = {
              id: idPersonalizado,
              titulo,
              autor,
              editorial,
              lugar,
              paginas,
              anio,
              inventarioUnico: inventario,
              imagen: imagenData,
              fechaIngreso, // A침adido dentro del objeto que guarda cada ejemplar

            };

            const ref = db.collection('libros').doc(idPersonalizado);
            promesas.push(ref.set(ejemplar));
          }
          await Promise.all(promesas);
        } else {
          // Editar existentes
          const batch = db.batch();
          docsEjemplaresActuales.forEach((doc) => {
            const docRef = db.collection('libros').doc(doc.id);
            batch.update(docRef, {
              titulo,
              autor,
              editorial,
              lugar,
              paginas,
              anio,
              imagen: imagenData || doc.data().imagen,
            });
          });
          await batch.commit();
        }

        modal.style.display = 'none';
        location.reload();
      } catch (error) {
        console.error('Error guardando libro:', error);
        alert('Ocurri칩 un error al guardar el libro.');
      }
    }

    async function cargarLibros() {
      const snapshot = await db.collection('libros').orderBy('inventarioUnico', 'asc').get();

      const librosAgrupados = {};

      snapshot.forEach((doc) => {
        const data = doc.data();
        const key = data.titulo.trim().toLowerCase();
        if (!librosAgrupados[key]) {
          librosAgrupados[key] = {
            docs: [doc],
            titulo: data.titulo,
            autor: data.autor,
            editorial: data.editorial,
            lugar: data.lugar,
            paginas: data.paginas,
            anio: data.anio,
            imagen: data.imagen,
            cantidad: 1,
          };
        } else {
          librosAgrupados[key].cantidad++;
          librosAgrupados[key].docs.push(doc);
        }
      });

      const contenedor = document.querySelector('.contenedor-cuadros');
      contenedor.innerHTML = '';

      Object.values(librosAgrupados).forEach((libro) => {
        const nuevoCuadro = document.createElement('div');
        nuevoCuadro.classList.add('cuadro');

        nuevoCuadro.innerHTML = `
          <div>
            <h3>${libro.titulo}</h3>
            <p><strong>Autor:</strong> ${libro.autor}</p>
            <p><strong>Editorial:</strong> ${libro.editorial}</p>
            <p><strong>Lugar:</strong> ${libro.lugar}</p>
            <p><strong>P치ginas:</strong> ${libro.paginas}</p>
            <p><strong>A침o:</strong> ${libro.anio}</p>
            <p><strong>Fecha de ingreso:</strong> ${libro.docs[0].data().fechaIngreso || 'Sin registrar'}</p>

            <p><strong>Cantidad de ejemplares:</strong> ${libro.cantidad}</p>
            ${
              libro.imagen
                ? `<img src="${libro.imagen}" style="width:100px; height:100px; object-fit:cover;">`
                : ''
            }
            <button class="editar-btn">Editar</button>
          </div>
        `;

        const btnEditar = nuevoCuadro.querySelector('.editar-btn');
        btnEditar.addEventListener('click', () => abrirModalEdicion(libro));

        contenedor.appendChild(nuevoCuadro);
      });
    }

    function limpiarModal() {
      document.getElementById('titulo').value = '';
      document.getElementById('fechaIngreso').value = libro.docs[0].data().fechaIngreso || '';
      document.getElementById('autor').value = '';
      document.getElementById('editorial').value = '';
      document.getElementById('lugar').value = '';
      document.getElementById('paginas').value = '';
      document.getElementById('anio').value = '';
      document.getElementById('inventarioBase').value = '';
      document.getElementById('cantidadEjemplares').value = '';
      imagenInput.value = '';
      imagenPreview.src = '';
      imagenPreview.style.display = 'none';
      imagenData = '';
      document.getElementById('fechaIngresoTexto').textContent =
        `Fecha de ingreso: ${libro.docs[0].data().fechaIngreso || 'No registrada'}`;

      listaEjemplares.innerHTML = '';
      modoEdicion = false;
      docsEjemplaresActuales = [];
      tituloOriginal = '';
      document.getElementById('inventarioBase').disabled = false;
      document.getElementById('cantidadEjemplares').disabled = false;
    }

    function abrirModalEdicion(libro) {
      modoEdicion = true;
      limpiarModal();
      modal.style.display = 'block';
      modalTitulo.textContent = `Editar libro: ${libro.titulo}`;

      document.getElementById('titulo').value = libro.titulo;
      document.getElementById('autor').value = libro.autor;
      document.getElementById('editorial').value = libro.editorial;
      document.getElementById('lugar').value = libro.lugar;
      document.getElementById('paginas').value = libro.paginas;
      document.getElementById('anio').value = libro.anio;
      document.getElementById('inventarioBase').value = parseInt(libro.docs[0].data().inventarioUnico);
      document.getElementById('inventarioBase').disabled = false;
      document.getElementById('cantidadEjemplares').value = libro.cantidad;
      document.getElementById('cantidadEjemplares').disabled = false;

      imagenData = libro.imagen || '';
      if (imagenData) {
        imagenPreview.src = imagenData;
        imagenPreview.style.display = 'block';
      }

      docsEjemplaresActuales = libro.docs;
      tituloOriginal = libro.titulo;

      listaEjemplares.innerHTML = '';
      libro.docs.forEach((doc, index) => {
        const divEjemplar = document.createElement('div');
        divEjemplar.style.border = '1px solid #555';
        divEjemplar.style.margin = '5px 0';
        divEjemplar.style.padding = '5px';

        const numeroEjemplar = index + 1;
        const numeroInventario = doc.data().inventarioUnico;

        divEjemplar.textContent = `Ejemplar ${numeroEjemplar}: ${numeroInventario}`;
        listaEjemplares.appendChild(divEjemplar);
      });
    }

    // Generar rect치ngulos cuando cambian inventario base o cantidad
    document.getElementById('inventarioBase').addEventListener('input', generarRectangulosEjemplares);
    document.getElementById('cantidadEjemplares').addEventListener('input', generarRectangulosEjemplares);

    // Cargar libros al inicio
    window.addEventListener('load', cargarLibros);

    // Bot칩n backup - descarga el backup JSON ordenado por inventarioUnico
    document.getElementById('btn-backup').addEventListener('click', async () => {
      const snapshot = await db.collection('libros').orderBy('inventarioUnico', 'asc').get();
      const libros = [];
      snapshot.forEach((doc) => {
        libros.push({ id: doc.id, ...doc.data() });
      });
      const backupJSON = JSON.stringify(libros, null, 2);
      const blob = new Blob([backupJSON], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'backup_biblioteca.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    // Bot칩n importar backup
    const inputImportar = document.getElementById('input-importar');
    document.getElementById('btn-importar').addEventListener('click', () => {
      inputImportar.click();
    });
    inputImportar.addEventListener('change', async (event) => {
      const archivo = event.target.files[0];
      if (!archivo) return;

      const texto = await archivo.text();
      let datos;
      try {
        datos = JSON.parse(texto);
      } catch {
        alert('El archivo seleccionado no es un JSON v치lido.');
        return;
      }

      if (!Array.isArray(datos)) {
        alert('El JSON debe ser un array de libros.');
        return;
      }

      try {
        // Opcional: eliminar todos antes de importar (o preguntar)
        if (!confirm('Se eliminar치 el inventario actual antes de importar. 쯈uer칠s continuar?')) {
          return;
        }
        const docs = await db.collection('libros').get();
        const batchBorrar = db.batch();
        docs.forEach((doc) => batchBorrar.delete(doc.ref));
        await batchBorrar.commit();

        const batchAgregar = db.batch();
        datos.forEach((libro) => {
          const ref = db.collection('libros').doc();
          batchAgregar.set(ref, libro);
        });
        await batchAgregar.commit();

        alert('Backup importado correctamente.');
        location.reload();
      } catch (error) {
        alert('Error al importar backup: ' + error.message);
      }
    });

    // Bot칩n eliminar inventario completo
    document.getElementById('btn-borrar-todo').addEventListener('click', async () => {
      if (!confirm('쮼st치s seguro que quer칠s eliminar todo el inventario? Esta acci칩n no se puede deshacer.')) return;
      try {
        const docs = await db.collection('libros').get();
        const batch = db.batch();
        docs.forEach((doc) => batch.delete(doc.ref));
        await batch.commit();
        alert('Inventario eliminado correctamente.');
        location.reload();
      } catch (error) {
        alert('Error eliminando inventario: ' + error.message);
      }
    });

    function normalizarTexto(texto) {
      return texto
        .toLowerCase()
        .normalize("NFD") // separa acentos
        .replace(/[\u0300-\u036f]/g, ""); // elimina diacr칤ticos
    }

    function normalizarTexto(texto) {
      return texto
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, ""); // quita acentos
    }

    document.getElementById('barraInput').addEventListener('input', () => {
      const filtro = normalizarTexto(document.getElementById('barraInput').value.trim());
      const contenedor = document.querySelector('.contenedor-cuadros');
      const cuadros = Array.from(contenedor.getElementsByClassName('cuadro'));

      cuadros.forEach(cuadro => {
        const titulo = normalizarTexto(cuadro.querySelector('h3')?.textContent || '');
        cuadro.style.display = titulo.includes(filtro) || filtro === '' ? '' : 'none';
      });
    });




    const btnEliminar = document.getElementById('btnEliminar');

function abrirModalEdicion(libro) {
  modoEdicion = true;
  limpiarModal();
  modal.style.display = 'block';
  modalTitulo.textContent = `Editar libro: ${libro.titulo}`;

  // Carga datos en el modal
  document.getElementById('titulo').value = libro.titulo;
  document.getElementById('autor').value = libro.autor;
  document.getElementById('editorial').value = libro.editorial;
  document.getElementById('lugar').value = libro.lugar;
  document.getElementById('paginas').value = libro.paginas;
  document.getElementById('anio').value = libro.anio;
  document.getElementById('inventarioBase').value = parseInt(libro.docs[0].data().inventarioUnico);
  document.getElementById('inventarioBase').disabled = false;
  document.getElementById('cantidadEjemplares').value = libro.cantidad;
  document.getElementById('cantidadEjemplares').disabled = false;

  imagenData = libro.imagen || '';
  if (imagenData) {
    imagenPreview.src = imagenData;
    imagenPreview.style.display = 'block';
  }

  docsEjemplaresActuales = libro.docs;
  tituloOriginal = libro.titulo;

  listaEjemplares.innerHTML = '';
  libro.docs.forEach((doc, index) => {
    const divEjemplar = document.createElement('div');
    divEjemplar.style.border = '1px solid #555';
    divEjemplar.style.margin = '5px 0';
    divEjemplar.style.padding = '5px';

    const numeroEjemplar = index + 1;
    const numeroInventario = doc.data().inventarioUnico;

    divEjemplar.textContent = `Ejemplar ${numeroEjemplar}: ${numeroInventario}`;
    listaEjemplares.appendChild(divEjemplar);
  });

  // Mostrar bot칩n eliminar
  btnEliminar.style.display = 'inline-block';
}

// Evento para eliminar libro
  btnEliminar.addEventListener('click', async () => {
    if (!confirm("쮼st치s seguro de que quer칠s eliminar este libro y todos sus ejemplares?")) return;

    try {
      const batch = db.batch();
      docsEjemplaresActuales.forEach(doc => {
        const docRef = db.collection("libros").doc(doc.id);
        batch.delete(docRef);
      });
      await batch.commit();

      alert("Libro eliminado con 칠xito.");
      modal.style.display = 'none';
      location.reload();

    } catch (error) {
      console.error("Error eliminando libro:", error);
      alert("Ocurri칩 un error al intentar eliminar el libro.");
    }
  });

  // Ocultar bot칩n eliminar al limpiar modal
  function limpiarModal() {
    document.getElementById('titulo').value = '';
    document.getElementById('autor').value = '';
    document.getElementById('editorial').value = '';
    document.getElementById('lugar').value = '';
    document.getElementById('paginas').value = '';
    document.getElementById('anio').value = '';
    document.getElementById('inventarioBase').value = '';
    document.getElementById('cantidadEjemplares').value = '';
    imagenInput.value = '';
    imagenPreview.src = '';
    imagenPreview.style.display = 'none';
    imagenData = '';
    listaEjemplares.innerHTML = '';
    modoEdicion = false;
    docsEjemplaresActuales = [];
    tituloOriginal = '';
    document.getElementById('inventarioBase').disabled = false;
    document.getElementById('cantidadEjemplares').disabled = false;

    // Ocultar bot칩n eliminar
    btnEliminar.style.display = 'none';
  }

  modal.addEventListener('click', (event) => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });

  </script>


<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P치gina protegida</title>
<style>
  /* Modal b치sico */
  #authModal {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    z-index: 9999;
  }

  #authModalContent {
    background: #fff;
    padding: 25px 20px;
    border-radius: 10px;
    text-align: center;
    max-width: 400px;
    width: 90%;
  }

  #authModalContent input {
    width: 96%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
  }

  #authModalContent button {
    margin-top: 12px;
    padding: 8px 16px;
    border: none;
    background-color: #0e0955;
    color: white;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
  }

  #authMsg {
    margin-top: 8px;
    color: #b02a37;
    min-height: 18px;
  }
</style>
</head>
<body>


<script>
(function(){
  const PASSWORD = "ROBLIGADO25";

  // Crear modal
  const modal = document.createElement("div");
  modal.id = "authModal";
  modal.innerHTML = `
    <div id="authModalContent">
      <h3>Acceso restringido</h3>
      <p>Introduce la contrase침a:</p>
      <input type="password" id="authInput" />
      <div>
        <button id="authBtn">Ingresar</button>
      </div>
      <div id="authMsg"></div>
    </div>
  `;
  document.body.appendChild(modal);

  const input = modal.querySelector("#authInput");
  const btn = modal.querySelector("#authBtn");
  const msg = modal.querySelector("#authMsg");

  function tryLogin() {
    if(input.value.trim() === PASSWORD){
      modal.style.display = "none";
    } else {
      msg.textContent = "Contrase침a incorrecta";
      input.value = "";
      input.focus();
    }
  }

  btn.addEventListener("click", tryLogin);
  input.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") tryLogin();
  });

})();
</script>

</body>
</html>

  
</body>
</html>
